<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Score Poker - Multi Tours</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://media.istockphoto.com/id/1864437299/fr/vectoriel/illustration-vectorielle-de-fond-de-table-verte-de-poker-terrain-de-jeu-réaliste-pour-le.jpg?s=612x612&w=0&k=20&c=Cbie8F-Wj5PZdoq3vZRModg6TVlIaDeCQUzwJfsyza8=') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Courier New', Courier, monospace;
      color: #fff;
      position: relative;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 50vh);
      height: 100vh;
      gap: 10px;
      padding: 10px;
    }
    .player {
      border: 2px solid rgba(255,255,255,0.8);
      padding: 10px;
      position: relative;
      background: rgba(0,0,0,0.3);
    }
    .playerName {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .scoreDisplay {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .buttons {
      margin-bottom: 10px;
    }
    /* Boutons généraux (agrandis) */
    .buttons button {
      margin-right: 5px;
      padding: 15px 20px;
      font-size: 18px;
      cursor: pointer;
      border: none;
      transition: background-color 0.3s, transform 0.2s;
      border-radius: 5px;
    }
    /* Bouton +30 */
    button[data-value="30"] {
      background-color: #008000;
      color: #fff;
    }
    button[data-value="30"]:hover {
      background-color: #006400;
      transform: scale(1.05);
    }
    /* Bouton +50 */
    button[data-value="50"] {
      background-color: #FFA500;
      color: #fff;
    }
    button[data-value="50"]:hover {
      background-color: #FF8C00;
      transform: scale(1.05);
    }
    /* Bouton +100 */
    button[data-value="100"] {
      background-color: #FF0000;
      color: #fff;
    }
    button[data-value="100"]:hover {
      background-color: #B22222;
      transform: scale(1.05);
    }
    /* Bouton personnalisé reste en bleu par défaut */
    button[data-custom="true"] {
      background-color: #0000CD;
      color: #fff;
    }
    button[data-custom="true"]:hover {
      background-color: #00008B;
      transform: scale(1.05);
    }
    /* Bouton Retour */
    button[data-undo="true"] {
      background-color: #555;
      color: #fff;
    }
    button[data-undo="true"]:hover {
      background-color: #333;
      transform: scale(1.05);
    }
    .roundHistory {
      margin-top: 10px;
      font-size: 16px;
      background: rgba(0,0,0,0.5);
      padding: 5px;
      border-radius: 5px;
      max-height: 80px;
      overflow-y: auto;
    }
    /* Zone d'affichage des croix pour le total (1 croix par tranche de 100) */
    .stars {
      position: absolute;
      bottom: 5px;
      right: 5px;
      font-size: 20px;
      display: flex;
      gap: 5px;
      align-items: center;
    }
    .cross {
      width: 30px;
      height: 30px;
      display: inline-block;
    }
    .cross svg {
      width: 100%;
      height: 100%;
    }
    .cross line {
      stroke: #FFD700;
      stroke-width: 2;
      stroke-dasharray: 40;
      stroke-dashoffset: 40;
      animation: drawLine 0.5s forwards;
    }
    .cross line.second {
      animation-delay: 0.5s;
    }
    @keyframes drawLine {
      to { stroke-dashoffset: 0; }
    }
    /* Bouton global pour valider le tour */
    #validateRound {
      display: block;
      margin: 20px auto;
      padding: 15px 30px;
      font-size: 18px;
      border: none;
      background-color: #006400;
      color: #fff;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s, transform 0.2s;
    }
    #validateRound:hover {
      background-color: #228B22;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sections pour les 4 joueurs -->
    <div class="player" id="player1" data-total="0" data-round="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Total: 0 (Tour: 0)</div>
      <div class="buttons">
        <!-- Ordre croissant -->
        <button data-value="30">+30</button>
        <button data-value="50">+50</button>
        <button data-value="100">+100</button>
        <button data-custom="true">Personnalisé</button>
        <button data-undo="true">Retour</button>
      </div>
      <div class="roundHistory"></div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player2" data-total="0" data-round="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Total: 0 (Tour: 0)</div>
      <div class="buttons">
        <button data-value="30">+30</button>
        <button data-value="50">+50</button>
        <button data-value="100">+100</button>
        <button data-custom="true">Personnalisé</button>
        <button data-undo="true">Retour</button>
      </div>
      <div class="roundHistory"></div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player3" data-total="0" data-round="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Total: 0 (Tour: 0)</div>
      <div class="buttons">
        <button data-value="30">+30</button>
        <button data-value="50">+50</button>
        <button data-value="100">+100</button>
        <button data-custom="true">Personnalisé</button>
        <button data-undo="true">Retour</button>
      </div>
      <div class="roundHistory"></div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player4" data-total="0" data-round="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Total: 0 (Tour: 0)</div>
      <div class="buttons">
        <button data-value="30">+30</button>
        <button data-value="50">+50</button>
        <button data-value="100">+100</button>
        <button data-custom="true">Personnalisé</button>
        <button data-undo="true">Retour</button>
      </div>
      <div class="roundHistory"></div>
      <div class="stars"></div>
    </div>
  </div>
  
  <!-- Bouton global pour valider le tour -->
  <button id="validateRound">Valider le tour</button>
  
  <script>
    // Récupération des noms des joueurs depuis sessionStorage ou valeurs par défaut
    const storedNames = sessionStorage.getItem('playerNames');
    const playerNames = storedNames ? JSON.parse(storedNames) : {
      player1: "Joueur 1",
      player2: "Joueur 2",
      player3: "Joueur 3",
      player4: "Joueur 4"
    };

    // Affecte les noms aux éléments et initialise undoStack et historique pour chaque joueur
    document.querySelectorAll('.player').forEach((player, index) => {
      const nameElem = player.querySelector('.playerName');
      nameElem.textContent = playerNames['player' + (index + 1)];
      player.undoStack = []; // pour les modifications du tour en cours
      player.roundHistoryArr = []; // pour l'historique des tours
    });

    // Création d'une croix animée en SVG (pour chaque tranche de 100 du total)
    function createCrossElement() {
      const span = document.createElement('span');
      span.className = 'cross';
      span.innerHTML = `
        <svg viewBox="0 0 30 30">
          <line x1="5" y1="5" x2="25" y2="25" />
          <line class="second" x1="25" y1="5" x2="5" y2="25" />
        </svg>
      `;
      return span;
    }

    // Met à jour l'affichage d'un joueur (total, tour, historique, croix)
    function updateDisplay(playerElem) {
      const scoreDisplay = playerElem.querySelector('.scoreDisplay');
      const starsDisplay = playerElem.querySelector('.stars');
      const roundHistoryDiv = playerElem.querySelector('.roundHistory');
      let total = parseInt(playerElem.dataset.total);
      let round = parseInt(playerElem.dataset.round);
      
      scoreDisplay.textContent = 'Total: ' + total + ' (Tour: ' + round + ')';
      
      // Affiche des croix pour chaque tranche de 100 dans le total
      starsDisplay.innerHTML = "";
      let nbCrosses = Math.floor(total / 100);
      let reste = total % 100;
      for (let i = 0; i < nbCrosses; i++) {
        starsDisplay.appendChild(createCrossElement());
      }
      if (reste > 0) {
        const resteSpan = document.createElement('span');
        resteSpan.textContent = " (" + reste + ")";
        starsDisplay.appendChild(resteSpan);
      }
      
      // Met à jour l'historique des tours
      roundHistoryDiv.innerHTML = "";
      if (playerElem.roundHistoryArr.length > 0) {
        const ul = document.createElement('ul');
        playerElem.roundHistoryArr.forEach((score, idx) => {
          const li = document.createElement('li');
          li.textContent = "Tour " + (idx + 1) + " : " + score;
          ul.appendChild(li);
        });
        roundHistoryDiv.appendChild(ul);
      }
    }

    // Gère les boutons d'ajout et le bouton "Retour" pour chaque joueur
    document.querySelectorAll('.player').forEach(player => {
      updateDisplay(player);
      player.querySelectorAll('.buttons button').forEach(button => {
        button.addEventListener('click', () => {
          if (button.hasAttribute('data-undo')) {
            // Bouton "Retour" : annule la dernière modification du tour en cours
            if (player.undoStack.length > 0) {
              const lastAddition = player.undoStack.pop();
              let roundScore = parseInt(player.dataset.round);
              roundScore -= lastAddition;
              player.dataset.round = roundScore;
              updateDisplay(player);
            }
          } else {
            let addition = 0;
            if (button.hasAttribute('data-custom')) {
              let customValue = prompt("Entrez une valeur personnalisée :");
              if (customValue !== null && !isNaN(customValue)) {
                addition = parseInt(customValue);
              }
            } else {
              addition = parseInt(button.getAttribute('data-value'));
            }
            // Enregistre cette addition dans l'undoStack pour ce tour
            player.undoStack.push(addition);
            let roundScore = parseInt(player.dataset.round);
            roundScore += addition;
            player.dataset.round = roundScore;
            updateDisplay(player);
          }
        });
      });
    });

    // Bouton global "Valider le tour" : ajoute le score du tour au total, enregistre l'historique, et réinitialise le tour
    document.getElementById('validateRound').addEventListener('click', () => {
      document.querySelectorAll('.player').forEach(player => {
        let roundScore = parseInt(player.dataset.round);
        let total = parseInt(player.dataset.total);
        total += roundScore;
        player.dataset.total = total;
        player.roundHistoryArr.push(roundScore);
        player.dataset.round = 0;
        player.undoStack = [];
        updateDisplay(player);
      });
    });
  </script>
</body>
</html>
