<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Score Poker</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: url('https://media.istockphoto.com/id/1864437299/fr/vectoriel/illustration-vectorielle-de-fond-de-table-verte-de-poker-terrain-de-jeu-r%C3%A9aliste-pour-le.jpg?s=612x612&w=0&k=20&c=Cbie8F-Wj5PZdoq3vZRModg6TVlIaDeCQUzwJfsyza8=') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Courier New', Courier, monospace;
      color: #fff;
    }
    .container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 50vh);
      height: 100vh;
    }
    .player {
      border: 2px solid rgba(255,255,255,0.8);
      margin: 10px;
      padding: 10px;
      position: relative;
      transition: background-color 0.3s;
      background: rgba(0,0,0,0.3);
    }
    .playerName {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .scoreDisplay {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .buttons {
      margin-bottom: 10px;
    }
    .buttons button {
      margin-right: 5px;
      padding: 10px 15px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      background-color: #006400;
      color: #fff;
      transition: background-color 0.3s;
    }
    .buttons button:hover {
      background-color: #228B22;
    }
    /* Zone d'affichage des croix et du reste */
    .stars {
      position: absolute;
      bottom: 5px;
      right: 5px;
      font-size: 20px;
      text-align: right;
      display: flex;
      gap: 5px;
      align-items: center;
    }
    /* Style pour la croix animée */
    .cross {
      width: 30px;
      height: 30px;
      display: inline-block;
    }
    .cross svg {
      width: 100%;
      height: 100%;
    }
    .cross line {
      stroke: #FFD700;
      stroke-width: 2;
      stroke-dasharray: 40;
      stroke-dashoffset: 40;
      animation: drawLine 0.5s forwards;
    }
    .cross line.second {
      animation-delay: 0.5s;
    }
    @keyframes drawLine {
      to {
        stroke-dashoffset: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Sections pour les 4 joueurs -->
    <div class="player" id="player1" data-score="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Score: 0</div>
      <div class="buttons">
        <button data-value="50">+50</button>
        <button data-value="30">+30</button>
        <button data-value="100">+100</button>
        <button data-custom="true">+</button>
        <button data-undo="true">Effacer</button>
      </div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player2" data-score="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Score: 0</div>
      <div class="buttons">
        <button data-value="50">+50</button>
        <button data-value="30">+30</button>
        <button data-value="100">+100</button>
        <button data-custom="true">+</button>
        <button data-undo="true">Effacer</button>
      </div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player3" data-score="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Score: 0</div>
      <div class="buttons">
        <button data-value="50">+50</button>
        <button data-value="30">+30</button>
        <button data-value="100">+100</button>
        <button data-custom="true">+</button>
        <button data-undo="true">Effacer</button>
      </div>
      <div class="stars"></div>
    </div>
    <div class="player" id="player4" data-score="0">
      <div class="playerName"></div>
      <div class="scoreDisplay">Score: 0</div>
      <div class="buttons">
        <button data-value="50">+50</button>
        <button data-value="30">+30</button>
        <button data-value="100">+100</button>
        <button data-custom="true">+</button>
        <button data-undo="true">Effacer</button>
      </div>
      <div class="stars"></div>
    </div>
  </div>
  
  <script>
    // Récupération des noms de joueurs depuis sessionStorage
    const storedNames = sessionStorage.getItem('playerNames');
    const playerNames = storedNames ? JSON.parse(storedNames) : {
      player1: "Joueur 1",
      player2: "Joueur 2",
      player3: "Joueur 3",
      player4: "Joueur 4"
    };

    // Affectation des noms aux éléments correspondants et initialisation de la pile d'annulation
    document.querySelectorAll('.player').forEach((player, index) => {
      const nameElem = player.querySelector('.playerName');
      nameElem.textContent = playerNames['player' + (index + 1)];
      // On initialise la pile avec le score initial (0)
      player.undoStack = [0];
    });

    // Création d'une croix animée en SVG (animation ligne par ligne)
    function createCrossElement() {
      const span = document.createElement('span');
      span.className = 'cross';
      span.innerHTML = `
        <svg viewBox="0 0 30 30">
          <line x1="5" y1="5" x2="25" y2="25" />
          <line class="second" x1="25" y1="5" x2="5" y2="25" />
        </svg>
      `;
      return span;
    }

    // Mise à jour de l'affichage du score et des croix
    function updateDisplay(playerElem) {
      const scoreDisplay = playerElem.querySelector('.scoreDisplay');
      const starsDisplay = playerElem.querySelector('.stars');
      let score = parseInt(playerElem.getAttribute('data-score'));
      
      scoreDisplay.textContent = 'Score: ' + score;
      
      // Calcul : 1 croix pour chaque tranche de 100
      let nbCrosses = Math.floor(score / 100);
      let reste = score % 100;
      
      // Reconstruction de la zone d'affichage
      starsDisplay.innerHTML = "";
      for (let i = 0; i < nbCrosses; i++) {
        starsDisplay.appendChild(createCrossElement());
      }
      if (reste > 0) {
        const resteSpan = document.createElement('span');
        resteSpan.textContent = " (" + reste + ")";
        starsDisplay.appendChild(resteSpan);
      }
    }

    // Gestion des boutons pour la modification du score et annulation du dernier changement
    document.querySelectorAll('.player').forEach(player => {
      updateDisplay(player);
      player.querySelectorAll('.buttons button').forEach(button => {
        button.addEventListener('click', () => {
          // Bouton "Effacer" pour annuler la dernière modification
          if (button.hasAttribute('data-undo')) {
            if (player.undoStack.length > 1) {
              // Retire le dernier score et revient à l'état précédent
              player.undoStack.pop();
              let previousScore = player.undoStack[player.undoStack.length - 1];
              player.setAttribute('data-score', previousScore);
              updateDisplay(player);
            }
          } else {
            // Sauvegarde l'état actuel avant modification
            let currentScore = parseInt(player.getAttribute('data-score'));
            // On ajoute le score actuel à la pile d'annulation
            player.undoStack.push(currentScore);
            if (button.hasAttribute('data-custom')) {
              let customValue = prompt("Entrez une valeur personnalisée :");
              if (customValue !== null && !isNaN(customValue)) {
                currentScore += parseInt(customValue);
              }
            } else {
              currentScore += parseInt(button.getAttribute('data-value'));
            }
            player.setAttribute('data-score', currentScore);
            updateDisplay(player);
          }
        });
      });
    });
  </script>
</body>
</html>
